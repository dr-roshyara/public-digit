Excellent! Now I have the complete picture. Based on our discussion, let's proceed with the **corrected Phase 0.1 implementation**.

## **üéØ CONFIRMED ARCHITECTURE:**
- ‚úÖ **Subscriptions in Landlord DB** (`publicdigit`) - Service provider manages
- ‚úÖ **Tenant databases** - Isolated operational data only
- ‚úÖ **Pest** for testing (matching Phase 0)
- ‚úÖ **Bootstrap/providers.php** registration

## **üöÄ STARTING IMPLEMENTATION**

### **Step 1: Database Schema (Landlord Database)**

Let me create the first migration for the landlord database:

```bash
cd packages/laravel-backend
php artisan make:migration create_tenant_subscriptions_table --connection=landlord
```

```php
<?php
// database/migrations/landlord/2025_01_06_000001_create_tenant_subscriptions_table.php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::connection('landlord')->create('tenant_subscriptions', function (Blueprint $table) {
            $table->id();
            $table->foreignId('tenant_id')->constrained()->onDelete('cascade');
            $table->string('module')->comment('digital_card, membership, etc.');
            $table->string('plan')->default('free')->comment('free, pro, enterprise');
            $table->integer('price_level')->default(1)->comment('1 or 2');
            $table->json('features')->nullable()->comment('Custom features JSON');
            $table->integer('card_limit')->default(0)->comment('0 = unlimited, 500 for free tier');
            $table->integer('current_usage')->default(0);
            $table->timestamp('trial_ends_at')->nullable();
            $table->timestamp('billing_cycle_ends_at')->nullable();
            $table->boolean('is_active')->default(true);
            $table->timestamps();
            
            $table->unique(['tenant_id', 'module']);
            $table->index(['tenant_id', 'module', 'is_active']);
        });
    }

    public function down(): void
    {
        Schema::connection('landlord')->dropIfExists('tenant_subscriptions');
    }
};
```

### **Step 2: Feature Flags Migration**

```bash
php artisan make:migration create_feature_flags_table --connection=landlord
```

```php
<?php
// database/migrations/landlord/2025_01_06_000002_create_feature_flags_table.php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::connection('landlord')->create('feature_flags', function (Blueprint $table) {
            $table->id();
            $table->string('module')->comment('digital_card');
            $table->string('feature_key')->comment('bulk_operations, exports, realtime');
            $table->string('feature_name');
            $table->integer('min_price_level')->default(1)->comment('1 or 2');
            $table->json('metadata')->nullable();
            $table->timestamps();
            
            $table->unique(['module', 'feature_key']);
            $table->index(['module', 'min_price_level']);
        });
    }

    public function down(): void
    {
        Schema::connection('landlord')->dropIfExists('feature_flags');
    }
};
```

### **Step 3: Run Migrations**

```bash
php artisan migrate --database=landlord --path=database/migrations/landlord
```

### **Step 4: Write Failing Test (TDD RED Phase)**

Let me create a failing test for subscription creation:

```bash
mkdir -p tests/Feature/Contexts/Subscription
touch tests/Feature/Contexts/Subscription/SubscriptionManagementTest.php
```

```php
<?php
// tests/Feature/Contexts/Subscription/SubscriptionManagementTest.php

use App\Models\Tenant;
use App\Models\Landlord\TenantSubscription;

test('service provider can create subscription for tenant', function () {
    // Arrange
    $tenant = Tenant::factory()->create();
    
    // Act
    $response = $this->actingAs($this->createServiceProviderAdmin())
        ->postJson("/api/service-provider/tenants/{$tenant->id}/subscriptions", [
            'module' => 'digital_card',
            'plan' => 'pro',
            'price_level' => 1,
        ]);
    
    // Assert
    $response->assertStatus(201);
    
    $this->assertDatabaseHas('tenant_subscriptions', [
        'tenant_id' => $tenant->id,
        'module' => 'digital_card',
        'plan' => 'pro',
        'is_active' => true,
    ], 'landlord');
});

test('tenant cannot create subscription', function () {
    // Arrange
    $tenant = Tenant::factory()->create();
    $tenantAdmin = $this->createTenantAdmin($tenant);
    
    // Act
    $response = $this->actingAs($tenantAdmin)
        ->postJson("/api/service-provider/tenants/{$tenant->id}/subscriptions", [
            'module' => 'digital_card',
            'plan' => 'pro',
        ]);
    
    // Assert
    $response->assertForbidden();
});
```

**The test will fail (RED)** because we haven't implemented the controller, service, or routes yet.

---

**I'll pause here for your review.** 

**Next Steps** (after you confirm this approach):
1. ‚úÖ Database schema in landlord DB (done)
2. ‚ùå Implement Domain Layer (models, value objects)
3. ‚ùå Implement SubscriptionService
4. ‚ùå Create controller and routes
5. ‚ùå Implement FeatureGateService
6. ‚ùå Create admin UI for service provider

**Questions before I proceed:**

1. **Do you have existing models for landlord database?** (Like `Tenant` model already uses landlord connection?)
2. **Where should the SubscriptionService live?** (In a new `SubscriptionContext` or in existing service provider area?)
3. **Service Provider Admin Authentication:** How do service provider admins authenticate? (Different guard from tenant admins?)

Please confirm the database migrations look correct and whether you want me to continue with the implementation.