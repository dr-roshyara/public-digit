# **DIGITALCARD CONTEXT - ENTERPRISE ARCHITECTURE DIAGRAM**

## **ğŸ“Š COMPLETE SYSTEM ARCHITECTURE**

```mermaid
graph TB
    subgraph "EXTERNAL SYSTEMS & CLIENTS"
        VUE[Vue 3 Desktop Admin<br/>Inertia.js]
        ANG[Angular Mobile App<br/>Ionic/Capacitor]
        WALL[Apple/Google Wallet<br/>Mobile Wallets]
        API[External APIs<br/>Partners/Integrations]
    end

    subgraph "GATEWAY LAYER<br/>6-Case Routing"
        GW1[API Gateway<br/>Case 4: /{tenant}/api/v1/*<br/>Desktop Admin]
        GW2[API Gateway<br/>Case 2: /{tenant}/mapi/v1/*<br/>Mobile API]
        GW3[WebSocket Gateway<br/>Real-time Updates]
    end

    subgraph "DIGITALCARD BOUNDED CONTEXT<br/>Core Business Logic"
        subgraph "DOMAIN LAYER<br/>Pure Business Logic"
            AGG1[DigitalCard Aggregate<br/>Member Identity Card]
            AGG2[GuestCard Aggregate<br/>Temporary Guest Access]
            VO1[Value Objects<br/>CardId, MemberId, QRCode]
            ENUM1[Enums<br/>CardStatus, GuestCardType]
            EVT[Domain Events<br/>CardIssued, CardValidated, etc.]
            
            AGG1 -->|contains| VO1
            AGG2 -->|contains| VO1
            AGG1 -->|publishes| EVT
            AGG2 -->|publishes| EVT
        end

        subgraph "APPLICATION LAYER<br/>Use Case Orchestration"
            CMD1[Commands<br/>IssueCard, ValidateCard, RevokeCard]
            CMD2[Commands<br/>IssueGuestCard, ValidateGuest]
            HAND1[Command Handlers<br/>Business Logic Orchestration]
            QRY1[Queries<br/>GetMemberCard, GetCardHistory]
            DTO1[DTOs<br/>Data Transfer Objects]
            
            CMD1 -->|processed by| HAND1
            CMD2 -->|processed by| HAND1
            HAND1 -->|returns| DTO1
        end

        subgraph "DOMAIN SERVICES<br/>Cross-Aggregate Logic"
            DS1[CardValidationService<br/>Online/Offline Validation]
            DS2[CardIssuanceService<br/>Card Creation Logic]
            DS3[GuestCardPolicyEngine<br/>Guest Card Rules]
            DS4[OfflineValidationSystem<br/>Bundle Generation]
            DS5[DigitalWalletIntegration<br/>Wallet Pass Creation]
        end
    end

    subgraph "INFRASTRUCTURE LAYER<br/>Technical Implementation"
        subgraph "PERSISTENCE"
            REPO1[DigitalCardRepository<br/>Aggregate Persistence]
            REPO2[GuestCardRepository<br/>Guest Card Storage]
            REPO3[AuditRepository<br/>Compliance & Audit]
            PROJ1[RealTimeProjector<br/>CQRS Projections]
            PROJ2[EventProjector<br/>Read Model Updates]
            
            REPO1 -->|implements| AGG1
            REPO2 -->|implements| AGG2
            EVT -->|consumed by| PROJ1
            EVT -->|consumed by| PROJ2
        end

        subgraph "EXTERNAL INTEGRATIONS"
            ACL1[MembershipEventSubscriber<br/>Anti-Corruption Layer]
            ACL2[CircuitBreaker<br/>Resilience Pattern]
            INT1[SignedQRCodeGenerator<br/>HMAC Signatures]
            INT2[WalletService<br/>Apple/Google Wallet]
            INT3[PushNotificationService<br/>Mobile Notifications]
            
            ACL1 -->|listens to| MEMBERSHIP_EVENTS
            ACL2 -->|protects| EXTERNAL_CALLS
        end

        subgraph "API LAYER"
            CTRL1[DigitalCardController<br/>Desktop Admin API]
            CTRL2[MobileCardController<br/>Mobile API]
            CTRL3[GuestCardController<br/>Guest Card API]
            MID1[ApiVersionNegotiation<br/>Version Management]
            MID2[TenantIsolation<br/>Multi-tenancy]
            
            CTRL1 -->|uses| HAND1
            CTRL2 -->|uses| HAND1
            CTRL3 -->|uses| HAND1
        end
    end

    subgraph "SUPPORTING INFRASTRUCTURE"
        subgraph "OBSERVABILITY"
            OBS1[DistributedTracer<br/>OpenTelemetry]
            OBS2[MetricsCollector<br/>Prometheus Metrics]
            OBS3[HealthCheckService<br/>K8s Readiness/Liveness]
            OBS4[LoggingPipeline<br/>Structured Logging]
        end

        subgraph "RESILIENCE"
            RES1[IdempotentEventProcessor<br/>Exactly-Once Processing]
            RES2[RateLimiter<br/>API Protection]
            RES3[CircuitBreaker<br/>Failure Isolation]
            RES4[RetryMechanism<br/>Transient Failure Handling]
        end

        subgraph "SECURITY"
            SEC1[JWT/Sanctum Auth<br/>Authentication]
            SEC2[TenantIsolation<br/>Data Separation]
            SEC3[AuditLogger<br/>Compliance Trail]
            SEC4[EncryptionService<br/>Data at Rest/Transit]
        end
    end

    subgraph "DATA STORES"
        subgraph "WRITE STORE<br/>Tenant Databases"
            TDB1[(Tenant DB 1<br/>Digital Cards)]
            TDB2[(Tenant DB 2<br/>Guest Cards)]
            TDB3[(Tenant DB 3<br/>Audit Logs)]
        end

        subgraph "READ STORE<br/>Optimized for Queries"
            RDB1[(Materialized Views<br/>Dashboards)]
            RDB2[(Time-Series DB<br/>Analytics)]
            RDB3[(Redis Cache<br/>Real-time Data)]
        end

        subgraph "EVENT STORE"
            ES1[(Event Store<br/>Domain Events)]
            ES2[(Message Queue<br/>Async Processing)]
        end
    end

    subgraph "EXTERNAL BOUNDED CONTEXTS<br/>Via Published Language"
        MEMBERSHIP[Membership Context<br/>Member Management]
        ELECTION[Election Context<br/>Voting & Elections]
        GEOGRAPHY[Geography Context<br/>Location Services]
        NOTIFICATION[Notification Context<br/>Messaging]
    end

    %% CONNECTIONS BETWEEN COMPONENTS

    %% External Clients to Gateway
    VUE -->|HTTP/HTTPS| GW1
    ANG -->|HTTP/HTTPS| GW2
    WALL -->|Push Notifications| GW3
    
    %% Gateway to API Layer
    GW1 -->|Routes to| CTRL1
    GW2 -->|Routes to| CTRL2
    
    %% API Layer to Application
    CTRL1 -->|Executes| CMD1
    CTRL2 -->|Executes| CMD1
    CTRL3 -->|Executes| CMD2
    
    %% Application to Domain
    HAND1 -->|Orchestrates| DS1
    HAND1 -->|Orchestrates| DS2
    HAND1 -->|Creates| AGG1
    HAND1 -->|Creates| AGG2
    
    %% Domain Services to External
    DS4 -->|Generates| OFFLINE_BUNDLES[Offline Validation Bundles]
    DS5 -->|Integrates with| WALL
    
    %% Persistence Connections
    REPO1 -->|Stores in| TDB1
    REPO2 -->|Stores in| TDB2
    REPO3 -->|Stores in| TDB3
    PROJ1 -->|Updates| RDB1
    PROJ2 -->|Updates| RDB2
    
    %% Event Flow
    EVT -->|Published to| ES2
    ES2 -->|Consumed by| PROJ1
    ES2 -->|Consumed by| PROJ2
    ES2 -->|Consumed by| ACL1
    
    %% Cross-Context Communication
    ACL1 -->|Listens to| MEMBERSHIP
    DS1 -->|Validates against| GEOGRAPHY
    EVT -->|Notifies| NOTIFICATION
    
    %% Infrastructure Services
    OBS1 -->|Traces| ALL_COMPONENTS[All Components]
    OBS2 -->|Collects from| ALL_COMPONENTS
    OBS3 -->|Monitors| ALL_COMPONENTS
    SEC1 -->|Protects| GW1
    SEC1 -->|Protects| GW2
    SEC2 -->|Enforces| TDB1
    SEC2 -->|Enforces| TDB2
    
    %% Resilience Patterns
    RES1 -->|Processes| EVT
    RES2 -->|Protects| CTRL1
    RES2 -->|Protects| CTRL2
    RES3 -->|Protects| ACL1
    RES4 -->|Handles| EXTERNAL_CALLS

    classDef external fill:#e1f5fe,stroke:#01579b
    classDef gateway fill:#f3e5f5,stroke:#4a148c
    classDef domain fill:#e8f5e8,stroke:#1b5e20
    classDef application fill:#fff3e0,stroke:#e65100
    classDef infrastructure fill:#fce4ec,stroke:#880e4f
    classDef persistence fill:#e0f2f1,stroke:#004d40
    classDef observability fill:#fff8e1,stroke:#ff6f00
    classDef resilience fill:#e8eaf6,stroke:#283593
    classDef security fill:#ffebee,stroke:#b71c1c
    classDef datastore fill:#f5f5f5,stroke:#212121
    classDef externalcontext fill:#f1f8e9,stroke:#33691e
    
    class VUE,ANG,WALL,API external
    class GW1,GW2,GW3 gateway
    class AGG1,AGG2,VO1,ENUM1,EVT domain
    class CMD1,CMD2,HAND1,QRY1,DTO1 application
    class DS1,DS2,DS3,DS4,DS5 domain
    class CTRL1,CTRL2,CTRL3,MID1,MID2 infrastructure
    class REPO1,REPO2,REPO3,PROJ1,PROJ2 persistence
    class ACL1,ACL2,INT1,INT2,INT3 infrastructure
    class OBS1,OBS2,OBS3,OBS4 observability
    class RES1,RES2,RES3,RES4 resilience
    class SEC1,SEC2,SEC3,SEC4 security
    class TDB1,TDB2,TDB3,RDB1,RDB2,RDB3,ES1,ES2 datastore
    class MEMBERSHIP,ELECTION,GEOGRAPHY,NOTIFICATION externalcontext
```

## **ğŸ”„ DATA FLOW SEQUENCE DIAGRAMS**

### **1. Card Issuance Flow**
```mermaid
sequenceDiagram
    participant A as Vue Admin
    participant G as API Gateway
    participant C as CardController
    participant H as IssueCardHandler
    participant S as CardIssuanceService
    participant R as DigitalCardRepository
    participant E as Event Dispatcher
    participant M as Membership Context

    A->>G: POST /{tenant}/api/v1/cards
    G->>C: Route to Controller
    C->>H: IssueCardCommand(memberId, expiresAt)
    
    H->>M: Validate Member Exists (ACL)
    M-->>H: Member Details
    
    H->>S: Create DigitalCard Aggregate
    S->>S: Generate CardId, QR Code
    S->>S: Apply Business Rules
    S-->>H: DigitalCard Aggregate
    
    H->>R: Save Aggregate
    R->>R: Persist to Tenant DB
    
    H->>E: Dispatch CardIssued Event
    E->>Notification: Send Issuance Notification
    E->>Audit: Record Audit Trail
    
    H-->>C: CardDTO
    C-->>G: HTTP 201 Created
    G-->>A: Success Response
```

### **2. Mobile Validation Flow (Online)**
```mermaid
sequenceDiagram
    participant M as Mobile App
    participant G as Mobile API Gateway
    participant C as MobileCardController
    participant H as ValidateCardHandler
    participant V as CardValidationService
    participant R as DigitalCardRepository
    participant Q as QR Validation Service
    participant A as Audit Service
    participant P as Projector

    M->>G: POST /{tenant}/mapi/v1/cards/{id}/validate
    G->>C: Route with Auth Token
    C->>H: ValidateCardCommand(cardId, context)
    
    H->>R: Load DigitalCard Aggregate
    R-->>H: DigitalCard
    
    H->>Q: Validate QR Signature
    Q-->>H: QR Valid
    
    H->>V: Validate Card Status & Expiry
    V-->>H: Validation Result
    
    alt Validation Successful
        H->>A: Record Successful Validation
        H->>P: Update Real-time Projections
        H-->>C: ValidationSuccess DTO
    else Validation Failed
        H->>A: Record Failed Validation
        H-->>C: ValidationFailure DTO
    end
    
    C-->>G: HTTP 200 with Result
    G-->>M: Validation Response
```

### **3. Offline Validation Flow**
```mermaid
sequenceDiagram
    participant M as Mobile App (Offline)
    participant O as Offline Validation Service
    participant B as Validation Bundle
    participant C as Cached Card Data
    participant L as Local Storage
    participant S as Sync Queue

    M->>O: validateCardOffline(cardId, context)
    O->>B: Load Cached Validation Bundle
    B-->>O: Encrypted Bundle
    
    O->>O: Decrypt Bundle (Local Key)
    O->>O: Verify Bundle Signature
    O->>O: Check Bundle Expiry
    
    O->>B: Check Bloom Filter for Card
    B-->>O: Card Possibly in Bundle
    
    O->>C: Retrieve Minimal Card Data
    C-->>O: Card Status, Expiry, Restrictions
    
    O->>O: Validate Against Offline Rules
    O->>O: Check Time/Location Restrictions
    
    alt Valid
        O->>L: Store Validation Event Locally
        O->>S: Queue for Sync
        O-->>M: OfflineValidationSuccess
    else Invalid
        O->>L: Store Failed Attempt
        O-->>M: OfflineValidationFailure
    end
    
    Note over M,S: When Online
    M->>S: Sync Queued Events
    S->>Server: Batch Upload Events
```

### **4. Cross-Context Event Flow (Membership Cancellation)**
```mermaid
sequenceDiagram
    participant MC as Membership Context
    participant EB as Event Bus
    participant S as MembershipEventSubscriber
    participant CB as Circuit Breaker
    participant R as DigitalCardRepository
    participant C as DigitalCard Aggregate
    participant N as Notification Service

    MC->>EB: Publish MembershipCancelled(memberId, reason)
    EB->>S: Deliver Event (Async)
    
    S->>CB: Check Circuit State
    CB-->>S: Circuit CLOSED
    
    S->>R: Find All Cards for Member
    R-->>S: Array of DigitalCards
    
    loop For Each Card
        S->>C: card.revoke("Membership cancelled")
        C->>C: Update Status to REVOKED
        C->>C: Record Revocation Reason
        S->>R: Save Updated Card
    end
    
    S->>N: Notify Member of Card Revocation
    N->>Member: Send Revocation Notice
    
    S->>EB: Publish CardsRevoked Event
    EB->>Audit: Record for Compliance
    EB->>Analytics: Update Dashboards
```

## **ğŸ—ï¸ ARCHITECTURAL DECISION RECORDS (ADRs)**

### **ADR-001: Separate Bounded Context**
```yaml
Title: DigitalCard as Separate Bounded Context
Status: Accepted
Context: Need to manage digital membership cards with own lifecycle
Decision: Create separate DigitalCardContext independent from Membership
Consequences:
  Pros:
    - Clear separation of concerns
    - Independent scaling
    - Specialized domain logic
    - Future extensibility (guest cards, wallets)
  Cons:
    - Increased complexity
    - Cross-context communication needed
    - Data consistency challenges
```

### **ADR-002: CQRS with Event Sourcing**
```yaml
Title: CQRS Pattern for Read/Write Separation
Status: Implemented in Phase 3
Context: Need real-time dashboards and complex queries
Decision: Implement Command-Query Responsibility Segregation
Consequences:
  Pros:
    - Optimized read performance
    - Real-time projections
    - Scalable query side
    - Audit trail via events
  Cons:
    - Eventual consistency
    - Increased infrastructure
    - Complex error handling
```

### **ADR-003: Multi-tenant Database Isolation**
```yaml
Title: Database-per-Tenant Pattern
Status: Mandatory (Platform Constraint)
Context: Strict tenant data isolation required
Decision: Physical database separation per tenant
Consequences:
  Pros:
    - Maximum data isolation
    - Independent backup/restore
    - Custom per-tenant schemas
    - Simplified data governance
  Cons:
    - Database connection overhead
    - Migration complexity
    - Higher operational cost
```

### **ADR-004: Offline-First Mobile Strategy**
```yaml
Title: Offline Validation Capability
Status: Implemented in Phase 4
Context: Mobile apps need to work in low-connectivity areas
Decision: Implement secure offline validation bundles
Consequences:
  Pros:
    - Operational resilience
    - Better user experience
    - Reduced server load
    - Bandwidth optimization
  Cons:
    - Security complexity
    - Bundle management
    - Sync conflict resolution
    - Increased mobile app size
```

## **ğŸ“ˆ SCALABILITY CONSIDERATIONS**

### **Horizontal Scaling Plan**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Load Balancer                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   API    â”‚  â”‚   API    â”‚  â”‚   API    â”‚         â”‚
â”‚  â”‚  Node 1  â”‚  â”‚  Node 2  â”‚  â”‚  Node N  â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  Worker  â”‚  â”‚  Worker  â”‚  â”‚  Worker  â”‚         â”‚
â”‚  â”‚  Pool 1  â”‚  â”‚  Pool 2  â”‚  â”‚  Pool N  â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           Redis Cluster (Cache & Queue)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚       â”‚  Read      â”‚         â”‚  Write     â”‚        â”‚
â”‚       â”‚  Replicas  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  Primary   â”‚        â”‚
â”‚       â”‚ (x5)       â”‚         â”‚  Database  â”‚        â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Database Partitioning Strategy**
```sql
-- Tenant-level partitioning
CREATE TABLE digital_cards (
    id UUID PRIMARY KEY,
    tenant_id BIGINT NOT NULL,
    member_id UUID NOT NULL,
    -- ... other columns
    PARTITION BY LIST (tenant_id)
);

-- Time-based partitioning for audit tables
CREATE TABLE card_validation_audit (
    id UUID PRIMARY KEY,
    occurred_at TIMESTAMPTZ NOT NULL,
    -- ... other columns
    PARTITION BY RANGE (occurred_at)
);
```

## **ğŸ” SECURITY ARCHITECTURE**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                SECURITY LAYERS                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  7. BUSINESS LOGIC                                  â”‚
â”‚     â€¢ Card validation rules                         â”‚
â”‚     â€¢ Access restrictions                           â”‚
â”‚     â€¢ Usage quotas                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  6. DATA LEVEL                                      â”‚
â”‚     â€¢ Row-level security                            â”‚
â”‚     â€¢ Column encryption                             â”‚
â”‚     â€¢ Audit logging                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  5. APPLICATION LEVEL                               â”‚
â”‚     â€¢ Input validation                              â”‚
â”‚     â€¢ Output encoding                               â”‚
â”‚     â€¢ CSRF protection                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  4. API GATEWAY                                     â”‚
â”‚     â€¢ Rate limiting                                 â”‚
â”‚     â€¢ DDoS protection                               â”‚
â”‚     â€¢ API key management                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  3. NETWORK LEVEL                                   â”‚
â”‚     â€¢ VPC isolation                                 â”‚
â”‚     â€¢ Security groups                               â”‚
â”‚     â€¢ WAF rules                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  2. INFRASTRUCTURE                                  â”‚
â”‚     â€¢ TLS 1.3 everywhere                            â”‚
â”‚     â€¢ Secret management                             â”‚
â”‚     â€¢ HSM for keys                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. PHYSICAL                                        â”‚
â”‚     â€¢ Data center security                          â”‚
â”‚     â€¢ Disk encryption                               â”‚
â”‚     â€¢ Backup encryption                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## **ğŸ¯ KEY PERFORMANCE INDICATORS**

| Layer | KPI | Target | Measurement |
|-------|-----|--------|-------------|
| **API** | P95 Response Time | < 200ms | APM Tooling |
| **Database** | Query Latency | < 50ms | DB Monitoring |
| **Cache** | Hit Rate | > 95% | Redis Metrics |
| **Queue** | Processing Lag | < 1s | Queue Monitoring |
| **Mobile** | Offline Success | > 99% | App Analytics |
| **Business** | Validation Success | > 99.5% | Business Metrics |

---

This architecture represents a **production-grade, enterprise-ready DigitalCardContext** that:
1. **Scales horizontally** to support millions of cards
2. **Maintains data isolation** across thousands of tenants  
3. **Provides real-time insights** through CQRS and projections
4. **Ensures resilience** with circuit breakers and retry logic
5. **Supports mobile-first** with offline capabilities
6. **Integrates seamlessly** with external systems via published language
7. **Maintains compliance** with comprehensive audit trails

The architecture respects all DDD principles while meeting the strict multi-tenancy, routing, and security requirements of your platform.