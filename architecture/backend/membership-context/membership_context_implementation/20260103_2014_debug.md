Perfect! Now I see the configuration. Let me analyze:

## **CONFIGURATION ANALYSIS:**

```php
// Testing environment uses:
'tenant_test' => [
    'database' => env('DB_TENANT_DATABASE', 'tenant_test_1'),  // From .env.testing: tenant_test
],
'landlord_test' => [
    'database' => env('DB_LANDLORD_DATABASE', 'publicdigit_test'),
],
```

But there's a **MISMATCH**:
- `.env.testing` has `DB_TENANT_DATABASE=tenant_test`
- Config default is `tenant_test_1` (with `_1` suffix)

## **PROBLEM:**

The test is trying to access `/uml/api/v1/members`, which:
1. `identify.tenant` middleware looks for tenant "uml" in `landlord_test` database
2. Finds nothing (because we haven't created test tenant)
3. Or finds production tenant in wrong database

## **SOLUTION:**

We need to **create a test tenant** in `landlord_test` database and use that slug.

### **Update Test Setup:**

```php
protected function setUp(): void
{
    parent::setUp();

    // Use test connections
    config(['database.default' => 'tenant_test']);
    
    // Create test tenant in landlord_test database
    $testTenantSlug = 'test-uml-' . Str::random(6);
    $this->createTestTenant($testTenantSlug);
    
    // Store for use in tests
    $this->tenantSlug = $testTenantSlug;
    
    // Rest of setup...
}

private function createTestTenant(string $slug): void
{
    // Get test database name from config
    $tenantDbName = config('database.connections.tenant_test.database', 'tenant_test');
    
    // Insert into landlord_test database
    \DB::connection('landlord_test')->table('tenants')->updateOrInsert(
        ['slug' => $slug],
        [
            'id' => Str::uuid()->toString(),
            'numeric_id' => rand(10000, 99999),
            'slug' => $slug,
            'name' => 'Test Tenant ' . $slug,
            'email' => 'test@' . $slug . '.com',
            'status' => 'active',
            'database_name' => $tenantDbName, // Should be 'tenant_test'
            'created_at' => now(),
            'updated_at' => now(),
        ]
    );
}
```

### **Update Test Routes:**

```php
public function admin_can_create_member_via_desktop_registration(): void
{
    // Use test tenant slug
    $response = $this->postJson("/{$this->tenantSlug}/api/v1/members", $payload);
    // ...
}
```

## **BETTER APPROACH: Test Trait**

Create `tests/Traits/CreatesTestTenant.php`:

```php
trait CreatesTestTenant
{
    protected string $testTenantSlug;
    
    protected function setUpCreatesTestTenant(): void
    {
        $this->testTenantSlug = 'test-' . Str::random(8);
        
        // Create in landlord_test
        \DB::connection('landlord_test')->table('tenants')->insert([
            'id' => Str::uuid()->toString(),
            'slug' => $this->testTenantSlug,
            'name' => 'Test Tenant',
            'database_name' => config('database.connections.tenant_test.database'),
            'status' => 'active',
        ]);
    }
    
    protected function getTestRoute(string $path): string
    {
        return "/{$this->testTenantSlug}" . $path;
    }
}
```

## **ACTION:**

Update the test to:
1. **Create unique test tenant** in `landlord_test` database
2. **Use that tenant slug** in all routes
3. **Ensure database names match** between config and tenant record

**Want me to implement the test trait approach?**

```diff
Edit file packages\laravel-backend\tests\Feature\Contexts\Membership\Desktop\MemberRegistrationApiTest.php
```

```php
<?php

declare(strict_types=1);

namespace Tests\Feature\Contexts\Membership\Desktop;

use Illuminate\Foundation\Testing\DatabaseTransactions;
use Illuminate\Support\Facades\Queue;
use Illuminate\Support\Str;
use Tests\TestCase;

/**
 * Desktop Member Registration API Tests
 *
 * Tests the desktop admin registration endpoint: POST /{tenant}/api/v1/members
 *
 * CASE 4: Tenant Desktop API - REGISTRATION ONLY
 * - Route: /{tenant}/api/v1/members (POST)
 * - Middleware: web, identify.tenant, auth (session)
 * - Admin creates member for existing tenant user
 * - Creates members with PENDING status (skips DRAFT)
 * - Admin provides existing tenant_user_id
 *
 * SCOPE: Registration endpoint ONLY (mirroring Mobile API DAY 2)
 * NOT IN SCOPE: Approval, listing, filtering (Phase 5 - Future)
 *
 * TDD Workflow:
 * 1. RED: Write failing tests (this file)
 * 2. GREEN: Implement desktop registration API
 * 3. REFACTOR: Clean up and optimize
 *
 * Database Strategy:
 * - Uses DatabaseTransactions (same as mobile tests)
 * - Environment-aware connections (tenant_test vs tenant)
 * - Requires authenticated admin user (session-based)
 * - Creates unique test tenant to avoid conflicts
 */
class MemberRegistrationApiTest extends TestCase
{
    use DatabaseTransactions;

    protected $connectionsToTransact = ['tenant_test'];
    
+    // Test tenant slug (unique per test run)
+    protected string $testTenantSlug;

    protected function setUp(): void
    {
        parent::setUp();

        // CRITICAL: Environment-aware connection
        $tenantConnection = app()->environment('testing') ? 'tenant_test' : 'tenant';

        // Set default connection for tests
        config(['database.default' => $tenantConnection]);

        // Create unique test tenant for identify.tenant middleware
+        $this->testTenantSlug = 'test-uml-' . Str::random(6);
        $this->createTestTenant();

        // Create admin user and authenticate (session-based)
        $this->createAndAuthenticateAdmin();

        // Mock domain service interfaces
        $this->setupDomainServiceMocks();

        // Fake queue for event testing
        Queue::fake();

        // CRITICAL: Bypass authorization gates for testing
        // TODO: Replace with proper permission setup when TenantAuth RBAC is integrated
        \Gate::before(function () {
            return true; // Allow all gate checks in tests
        });
    }

    /**
     * Create a test tenant in landlord_test database
     */
    private function createTestTenant(): void
    {
        $landlordConnection = app()->environment('testing') ? 'landlord_test' : 'landlord';
        $tenantConnection = app()->environment('testing') ? 'tenant_test' : 'tenant';

        // Get dynamic database name from config (should be 'tenant_test' from .env.testing)
        $tenantDbName = config('database.connections.' . $tenantConnection . '.database');

        // CRITICAL: Create unique test tenant in landlord_test database
        // NOT in production landlord database
        \DB::connection($landlordConnection)->table('tenants')->updateOrInsert(
-            ['slug' => 'uml'], // Match condition
+            ['slug' => $this->testTenantSlug],
            [
-                'id' => '550e8400-e29b-41d4-a716-446655440000',
+                'id' => Str::uuid()->toString(),
                'numeric_id' => 99999,
-                'slug' => 'uml',
-                'name' => 'Test Tenant UML',
-                'email' => 'admin@uml.example.com',
+                'slug' => $this->testTenantSlug,
+                'name' => 'Test Tenant ' . $this->testTenantSlug,
+                'email' => 'test-admin@' . $this->testTenantSlug . '.example.com',
                'status' => 'active',
                'database_name' => $tenantDbName, // Dynamic from config
                'created_at' => now(),
                'updated_at' => now(),
            ]
        );

        // Switch back to tenant database
        config(['database.default' => $tenantConnection]);
    }

    /**
     * Create admin user and authenticate with session
     */
    private function createAndAuthenticateAdmin(): void
    {
        // Create a mock user implementing both Authenticatable and Authorizable
        // Required for Spatie Permission package (used by auth middleware)
        // TODO: Replace with actual TenantUser when TenantAuth context is integrated

        $mockUser = new class implements
            \Illuminate\Contracts\Auth\Authenticatable,
            \Illuminate\Contracts\Auth\Access\Authorizable
        {
            // Properties required by middleware
            public $id = '01JKADMIN1234567890ABCDEFGH';
            public $email = 'admin@uml.example.com';
            public $tenant_id = 'uml';
            public $locale = 'en'; // Required by SetLocale middleware
            public $timezone = 'UTC'; // May be required by other middleware

            // Authenticatable interface methods
            public function getAuthIdentifierName() { return 'id'; }
            public function getAuthIdentifier() { return $this->id; }
            public function getAuthPassword() { return ''; }
            public function getRememberToken() { return ''; }
            public function setRememberToken($value) {}
            public function getRememberTokenName() { return 'remember_token'; }
            public function getAuthPasswordName() { return 'password'; }

            // Authorizable interface methods (for Spatie Permission)
            public function can($ability, $arguments = []) { return true; }
            public function cannot($ability, $arguments = []) { return false; }
            public function cant($ability, $arguments = []) { return false; }
        };

        $this->actingAs($mockUser, 'web'); // Session-based authentication
    }

    private function setupDomainServiceMocks(): void
    {
        // Same mocks as mobile tests
        // GeographyResolverInterface mocked in service provider
    }

    /** @test */
    public function admin_can_create_member_via_desktop_registration(): void
    {
        // Arrange: Use unique identifiers to avoid constraint violations
        $uniqueId = Str::random(8);
        $tenantUserId = '01JKUSER' . Str::upper(Str::random(18));

        $payload = [
            'tenant_user_id' => $tenantUserId, // REQUIRED: User already exists
            'full_name' => 'John Citizen',
            'email' => "john.citizen.{$uniqueId}@example.com",
            'phone' => '+977-9841234567',
            'member_id' => "UML-2025-{$uniqueId}",
            'geo_reference' => 'np.3.15.234',
        ];

        // Act: POST to desktop registration endpoint
-        $response = $this->postJson('/uml/api/v1/members', $payload);
+        $response = $this->postJson("/{$this->testTenantSlug}/api/v1/members", $payload);

        // Assert: Success response with PENDING status
        $response->assertStatus(201)
            ->assertJsonStructure([
                'data' => [
                    'id',
                    'type',
                    'attributes' => [
                        'member_id',
                        'tenant_user_id',
                        'tenant_id',
                        'personal_info',
                        'status',
                        'residence_geo_reference',
                        'membership_type',
                        'registration_channel',
                    ],
                    'links' => ['self'],
                ],
                'message',
            ])
            ->assertJson([
                'data' => [
                    'type' => 'member',
                    'attributes' => [
-                        'tenant_id' => 'uml',
+                        'tenant_id' => $this->testTenantSlug,
                        'tenant_user_id' => $tenantUserId,
                        'status' => 'pending', // Desktop → PENDING (skips DRAFT)
                        'registration_channel' => 'desktop',
                    ],
                ],
            ]);

        // Verify message indicates pending status
        $this->assertStringContainsString('pending', strtolower($response->json('message')));
    }

    /** @test */
    public function desktop_registration_requires_tenant_user_id(): void
    {
        // Arrange: Missing tenant_user_id (required for desktop)
        $uniqueId = Str::random(8);
        $payload = [
            'full_name' => 'John Citizen',
            'email' => "john.{$uniqueId}@example.com",
            // Missing tenant_user_id
        ];

        // Act
-        $response = $this->postJson('/uml/api/v1/members', $payload);
+        $response = $this->postJson("/{$this->testTenantSlug}/api/v1/members", $payload);

        // Assert: Validation error
        $response->assertStatus(422)
            ->assertJsonValidationErrors(['tenant_user_id']);
    }

    /** @test */
    public function desktop_registration_requires_authentication(): void
    {
        // Arrange: Logout (remove authentication)
        auth()->guard('web')->logout();

        $uniqueId = Str::random(8);
        $payload = [
            'tenant_user_id' => '01JKUSER' . Str::upper(Str::random(18)),
            'full_name' => 'John Citizen',
            'email' => "john.{$uniqueId}@example.com",
        ];

        // Act: POST without authentication
-        $response = $this->postJson('/uml/api/v1/members', $payload);
+        $response = $this->postJson("/{$this->testTenantSlug}/api/v1/members", $payload);

        // Assert: Unauthorized
        $response->assertStatus(401);
    }

    /** @test */
    public function desktop_registration_validates_tenant_user_id_format(): void
    {
        // Arrange: Invalid tenant_user_id format
        $uniqueId = Str::random(8);
        $payload = [
            'tenant_user_id' => 'invalid-format', // Not a valid ULID
            'full_name' => 'John Citizen',
            'email' => "john.{$uniqueId}@example.com",
        ];

        // Act
-        $response = $this->postJson('/uml/api/v1/members', $payload);
+        $response = $this->postJson("/{$this->testTenantSlug}/api/v1/members", $payload);

        // Assert: Validation error
        $response->assertStatus(422)
            ->assertJsonValidationErrors(['tenant_user_id']);
    }

    /** @test */
    public function desktop_registration_creates_member_with_pending_status(): void
    {
        // Arrange
        $uniqueId = Str::random(8);
        $payload = [
            'tenant_user_id' => '01JKUSER' . Str::upper(Str::random(18)),
            'full_name' => 'Pending User',
            'email' => "pending.{$uniqueId}@example.com",
        ];

        // Act
-        $response = $this->postJson('/uml/api/v1/members', $payload);
+        $response = $this->postJson("/{$this->testTenantSlug}/api/v1/members", $payload);

        // Assert: Desktop registration creates PENDING status (not DRAFT)
        $response->assertStatus(201)
            ->assertJson([
                'data' => [
                    'attributes' => [
                        'status' => 'pending', // Desktop → PENDING
                        'registration_channel' => 'desktop',
                    ],
                ],
            ]);
    }

    /** @test */
    public function desktop_registration_accepts_optional_fields(): void
    {
        // Arrange: Include all optional fields
        $uniqueId = Str::random(8);
        $payload = [
            'tenant_user_id' => '01JKUSER' . Str::upper(Str::random(18)),
            'full_name' => 'Jane Citizen',
            'email' => "jane.{$uniqueId}@example.com",
            'phone' => '+977-9841111111',
            'member_id' => "UML-2025-{$uniqueId}",
            'geo_reference' => 'np.3.15.234',
        ];

        // Act
-        $response = $this->postJson('/uml/api/v1/members', $payload);
+        $response = $this->postJson("/{$this->testTenantSlug}/api/v1/members", $payload);

        // Assert: All optional fields accepted
        $response->assertStatus(201);

        $attributes = $response->json('data.attributes');
        $this->assertEquals("UML-2025-{$uniqueId}", $attributes['member_id']);
        $this->assertEquals('+977-9841111111', $attributes['personal_info']['phone']);
        $this->assertEquals('np.3.15.234', $attributes['residence_geo_reference']);
    }

    /** @test */
    public function desktop_registration_validates_geography_reference_format(): void
    {
        // Arrange: Invalid geography reference format
        $uniqueId = Str::random(8);
        $payload = [
            'tenant_user_id' => '01JKUSER' . Str::upper(Str::random(18)),
            'full_name' => 'Test User',
            'email' => "test.{$uniqueId}@example.com",
            'geo_reference' => 'invalid-geo-format', // Invalid format
        ];

        // Act
-        $response = $this->postJson('/uml/api/v1/members', $payload);
+        $response = $this->postJson("/{$this->testTenantSlug}/api/v1/members", $payload);

        // Assert: Validation error
        $response->assertStatus(422)
            ->assertJsonValidationErrors(['geo_reference']);
    }
}
```