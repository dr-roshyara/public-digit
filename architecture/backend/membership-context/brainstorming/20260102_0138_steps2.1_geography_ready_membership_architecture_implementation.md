# üöÄ **STEP 2.1: MEMBER AGGREGATE ROOT TESTS (RED PHASE)**

## **üìÅ SETUP AGGREGATE ROOT DIRECTORY**

```bash
# Create directories for Member aggregate
mkdir -p app/Contexts/Membership/Domain/Models
mkdir -p app/Contexts/Membership/Domain/Events
mkdir -p tests/Unit/Contexts/Membership/Domain/Models
```

---

## **1Ô∏è‚É£ MEMBER CREATION TESTS**

### **Test File: Basic Member Creation**

```php
<?php

// tests/Unit/Contexts/Membership/Domain/Models/MemberCreationTest.php

namespace Tests\Unit\Contexts\Membership\Domain\Models;

use Tests\TestCase;
use App\Contexts\Membership\Domain\Models\Member;
use App\Contexts\Membership\Domain\ValueObjects\PersonalInfo;
use App\Contexts\Membership\Domain\ValueObjects\SimpleGeography;
use App\Contexts\Membership\Domain\ValueObjects\MemberStatus;
use App\Contexts\Membership\Domain\ValueObjects\MembershipNumber;
use App\Contexts\Membership\Domain\Exceptions\InvalidMemberException;

class MemberCreationTest extends TestCase
{
    /** @test */
    public function it_can_create_member_without_geography(): void
    {
        $personalInfo = new PersonalInfo(
            'John Doe',
            'john@example.com',
            '+9779841234567'
        );
        
        $membershipNumber = new MembershipNumber('UML', '2024', 'F', 1);
        
        $member = Member::create(
            personalInfo: $personalInfo,
            membershipNumber: $membershipNumber,
            geography: SimpleGeography::empty()
        );
        
        $this->assertInstanceOf(Member::class, $member);
        $this->assertEquals('John Doe', $member->personalInfo()->fullName());
        $this->assertEquals('UML-2024-F-000001', (string) $member->membershipNumber());
        $this->assertTrue($member->geography()->isEmpty());
        $this->assertTrue($member->status()->isDraft());
        $this->assertCount(1, $member->releaseEvents());
    }
    
    /** @test */
    public function it_can_create_member_with_basic_geography(): void
    {
        $personalInfo = new PersonalInfo(
            'Jane Smith',
            'jane@example.com',
            '+9779841234568'
        );
        
        $membershipNumber = new MembershipNumber('UML', '2024', 'F', 2);
        
        $geography = new SimpleGeography(
            province: 'Province 3',
            district: 'Kathmandu',
            ward: 'Ward 5'
        );
        
        $member = Member::create(
            personalInfo: $personalInfo,
            membershipNumber: $membershipNumber,
            geography: $geography
        );
        
        $this->assertEquals('Province 3', $member->geography()->province());
        $this->assertEquals('Kathmandu', $member->geography()->district());
        $this->assertEquals('Ward 5', $member->geography()->ward());
        $this->assertEquals('basic', $member->geography()->tier());
    }
    
    /** @test */
    public function it_can_create_member_with_advanced_geography(): void
    {
        $personalInfo = new PersonalInfo(
            'Ram Bahadur',
            'ram@example.com',
            '+9779841234569'
        );
        
        $membershipNumber = new MembershipNumber('UML', '2024', 'F', 3);
        
        $geography = SimpleGeography::empty()
            ->withText('Province 3', 'Kathmandu', 'Ward 5')
            ->withIds(3, 25, 125);
        
        $member = Member::create(
            personalInfo: $personalInfo,
            membershipNumber: $membershipNumber,
            geography: $geography
        );
        
        $this->assertEquals(3, $member->geography()->provinceId());
        $this->assertEquals(25, $member->geography()->districtId());
        $this->assertEquals(125, $member->geography()->wardId());
        $this->assertEquals('advanced', $member->geography()->tier());
    }
    
    /** @test */
    public function it_requires_personal_info(): void
    {
        $this->expectException(InvalidMemberException::class);
        $this->expectExceptionMessage('Personal info is required');
        
        Member::create(
            personalInfo: null,
            membershipNumber: new MembershipNumber('UML', '2024', 'F', 1),
            geography: SimpleGeography::empty()
        );
    }
    
    /** @test */
    public function it_requires_membership_number(): void
    {
        $this->expectException(InvalidMemberException::class);
        $this->expectExceptionMessage('Membership number is required');
        
        $personalInfo = new PersonalInfo(
            'John Doe',
            'john@example.com',
            '+9779841234567'
        );
        
        Member::create(
            personalInfo: $personalInfo,
            membershipNumber: null,
            geography: SimpleGeography::empty()
        );
    }
    
    /** @test */
    public function it_requires_geography_even_if_empty(): void
    {
        $this->expectException(InvalidMemberException::class);
        $this->expectExceptionMessage('Geography is required');
        
        $personalInfo = new PersonalInfo(
            'John Doe',
            'john@example.com',
            '+9779841234567'
        );
        
        Member::create(
            personalInfo: $personalInfo,
            membershipNumber: new MembershipNumber('UML', '2024', 'F', 1),
            geography: null
        );
    }
    
    /** @test */
    public function it_assigns_unique_id(): void
    {
        $personalInfo = new PersonalInfo(
            'John Doe',
            'john@example.com',
            '+9779841234567'
        );
        
        $member1 = Member::create(
            personalInfo: $personalInfo,
            membershipNumber: new MembershipNumber('UML', '2024', 'F', 1),
            geography: SimpleGeography::empty()
        );
        
        $member2 = Member::create(
            personalInfo: $personalInfo,
            membershipNumber: new MembershipNumber('UML', '2024', 'F', 2),
            geography: SimpleGeography::empty()
        );
        
        $this->assertNotNull($member1->id());
        $this->assertNotNull($member2->id());
        $this->assertNotEquals($member1->id(), $member2->id());
    }
    
    /** @test */
    public function it_records_member_created_event(): void
    {
        $personalInfo = new PersonalInfo(
            'John Doe',
            'john@example.com',
            '+9779841234567'
        );
        
        $member = Member::create(
            personalInfo: $personalInfo,
            membershipNumber: new MembershipNumber('UML', '2024', 'F', 1),
            geography: SimpleGeography::empty()
        );
        
        $events = $member->releaseEvents();
        
        $this->assertCount(1, $events);
        $this->assertInstanceOf(
            \App\Contexts\Membership\Domain\Events\MemberCreated::class,
            $events[0]
        );
    }
    
    /** @test */
    public function it_can_be_instantiated_with_existing_data(): void
    {
        $personalInfo = new PersonalInfo(
            'John Doe',
            'john@example.com',
            '+9779841234567'
        );
        
        $member = new Member([
            'id' => 'member-123',
            'personal_info' => $personalInfo,
            'membership_number' => new MembershipNumber('UML', '2024', 'F', 1),
            'geography' => SimpleGeography::empty(),
            'status' => MemberStatus::draft(),
        ]);
        
        $this->assertEquals('member-123', $member->id());
        $this->assertEquals('John Doe', $member->personalInfo()->fullName());
        $this->assertTrue($member->status()->isDraft());
    }
}
```

**Run test (should fail):**
```bash
php artisan test tests/Unit/Contexts/Membership/Domain/Models/MemberCreationTest.php
```

---

## **2Ô∏è‚É£ MEMBER LIFECYCLE TESTS**

### **Test File: Member Lifecycle Transitions**

```php
<?php

// tests/Unit/Contexts/Membership/Domain/Models/MemberLifecycleTest.php

namespace Tests\Unit\Contexts\Membership\Domain\Models;

use Tests\TestCase;
use App\Contexts\Membership\Domain\Models\Member;
use App\Contexts\Membership\Domain\ValueObjects\PersonalInfo;
use App\Contexts\Membership\Domain\ValueObjects\SimpleGeography;
use App\Contexts\Membership\Domain\ValueObjects\MembershipNumber;
use App\Contexts\Membership\Domain\ValueObjects\MemberStatus;
use App\Contexts\Membership\Domain\Events\MemberApplicationSubmitted;
use App\Contexts\Membership\Domain\Events\MemberApproved;
use App\Contexts\Membership\Domain\Events\MemberActivated;
use App\Contexts\Membership\Domain\Events\MemberSuspended;
use App\Contexts\Membership\Domain\Exceptions\InvalidStatusTransitionException;

class MemberLifecycleTest extends TestCase
{
    private function createDraftMember(): Member
    {
        $personalInfo = new PersonalInfo(
            'John Doe',
            'john@example.com',
            '+9779841234567'
        );
        
        return Member::create(
            personalInfo: $personalInfo,
            membershipNumber: new MembershipNumber('UML', '2024', 'F', 1),
            geography: SimpleGeography::empty()
        );
    }
    
    /** @test */
    public function member_can_submit_application(): void
    {
        $member = $this->createDraftMember();
        
        $member->submitApplication();
        
        $this->assertTrue($member->status()->isPending());
        
        $events = $member->releaseEvents();
        $this->assertCount(2, $events); // MemberCreated + MemberApplicationSubmitted
        $this->assertInstanceOf(MemberApplicationSubmitted::class, $events[1]);
    }
    
    /** @test */
    public function member_can_be_approved(): void
    {
        $member = $this->createDraftMember();
        $member->submitApplication(); // Now pending
        
        $member->approve(committeeMemberId: 123);
        
        $this->assertTrue($member->status()->isApproved());
        $this->assertEquals(123, $member->approvedBy());
        $this->assertNotNull($member->approvedAt());
        
        $events = $member->releaseEvents();
        $this->assertInstanceOf(MemberApproved::class, $events[2]);
    }
    
    /** @test */
    public function member_can_be_activated_after_payment(): void
    {
        $member = $this->createDraftMember();
        $member->submitApplication();
        $member->approve(123); // Now approved
        
        $member->activate(paymentId: 'pay_12345');
        
        $this->assertTrue($member->status()->isActive());
        $this->assertEquals('pay_12345', $member->paymentId());
        $this->assertNotNull($member->activatedAt());
        
        $events = $member->releaseEvents();
        $this->assertInstanceOf(MemberActivated::class, $events[3]);
    }
    
    /** @test */
    public function member_can_be_suspended(): void
    {
        $member = $this->createDraftMember();
        $member->submitApplication();
        $member->approve(123);
        $member->activate('pay_12345'); // Now active
        
        $member->suspend(reason: 'Non-payment of dues');
        
        $this->assertTrue($member->status()->isSuspended());
        $this->assertEquals('Non-payment of dues', $member->suspensionReason());
        
        $events = $member->releaseEvents();
        $this->assertInstanceOf(MemberSuspended::class, $events[4]);
    }
    
    /** @test */
    public function member_can_be_reactivated(): void
    {
        $member = $this->createDraftMember();
        $member->submitApplication();
        $member->approve(123);
        $member->activate('pay_12345');
        $member->suspend('Non-payment'); // Now suspended
        
        $member->reactivate();
        
        $this->assertTrue($member->status()->isActive());
        $this->assertNull($member->suspensionReason());
    }
    
    /** @test */
    public function it_cannot_approve_non_pending_member(): void
    {
        $member = $this->createDraftMember();
        // Still in draft, not submitted
        
        $this->expectException(InvalidStatusTransitionException::class);
        
        $member->approve(123);
    }
    
    /** @test */
    public function it_cannot_activate_non_approved_member(): void
    {
        $member = $this->createDraftMember();
        $member->submitApplication(); // Pending, not approved
        
        $this->expectException(InvalidStatusTransitionException::class);
        
        $member->activate('pay_12345');
    }
    
    /** @test */
    public function it_cannot_submit_already_submitted_application(): void
    {
        $member = $this->createDraftMember();
        $member->submitApplication(); // Now pending
        
        $this->expectException(InvalidStatusTransitionException::class);
        
        $member->submitApplication(); // Already submitted
    }
    
    /** @test */
    public function member_can_be_terminated(): void
    {
        $member = $this->createDraftMember();
        
        $member->terminate(reason: 'Voluntary resignation');
        
        $this->assertTrue($member->status()->isTerminated());
        $this->assertEquals('Voluntary resignation', $member->terminationReason());
    }
    
    /** @test */
    public function it_tracks_geography_enrichment(): void
    {
        $member = $this->createDraftMember();
        $this->assertTrue($member->geography()->isEmpty());
        
        $enrichedGeography = SimpleGeography::empty()
            ->withText('Province 3', 'Kathmandu', 'Ward 5')
            ->withIds(3, 25, 125);
        
        $member->enrichGeography($enrichedGeography);
        
        $this->assertEquals('advanced', $member->geography()->tier());
        $this->assertEquals(3, $member->geography()->provinceId());
        $this->assertEquals(25, $member->geography()->districtId());
        $this->assertEquals(125, $member->geography()->wardId());
        $this->assertNotNull($member->geographyEnrichedAt());
    }
    
    /** @test */
    public function it_can_add_sponsorship(): void
    {
        $member = $this->createDraftMember();
        
        $member->addSponsorship(sponsorId: 456);
        
        $this->assertEquals(456, $member->sponsorId());
    }
    
    /** @test */
    public function it_provides_privileges_based_on_status(): void
    {
        $member = $this->createDraftMember();
        $this->assertFalse($member->canVote());
        $this->assertFalse($member->canAccessForum());
        $this->assertFalse($member->canHoldOffice());
        
        $member->submitApplication(); // Pending
        $this->assertFalse($member->canVote());
        $this->assertFalse($member->canAccessForum());
        $this->assertFalse($member->canHoldOffice());
        
        $member->approve(123); // Approved
        $this->assertFalse($member->canVote());
        $this->assertTrue($member->canAccessForum()); // Read-only
        $this->assertFalse($member->canHoldOffice());
        
        $member->activate('pay_12345'); // Active
        $this->assertTrue($member->canVote());
        $this->assertTrue($member->canAccessForum());
        $this->assertTrue($member->canHoldOffice());
        
        $member->suspend('Non-payment'); // Suspended
        $this->assertFalse($member->canVote());
        $this->assertFalse($member->canAccessForum());
        $this->assertFalse($member->canHoldOffice());
    }
}
```

**Run test (should fail):**
```bash
php artisan test tests/Unit/Contexts/Membership/Domain/Models/MemberLifecycleTest.php
```

---

## **3Ô∏è‚É£ MEMBER VALIDATION TESTS**

### **Test File: Business Rule Validations**

```php
<?php

// tests/Unit/Contexts/Membership/Domain/Models/MemberValidationTest.php

namespace Tests\Unit\Contexts\Membership\Domain\Models;

use Tests\TestCase;
use App\Contexts\Membership\Domain\Models\Member;
use App\Contexts\Membership\Domain\ValueObjects\PersonalInfo;
use App\Contexts\Membership\Domain\ValueObjects\SimpleGeography;
use App\Contexts\Membership\Domain\ValueObjects\MembershipNumber;
use App\Contexts\Membership\Domain\ValueObjects\MemberStatus;
use App\Contexts\Membership\Domain\Exceptions\InvalidMemberException;

class MemberValidationTest extends TestCase
{
    /** @test */
    public function it_validates_member_for_submission(): void
    {
        $member = new Member([
            'personal_info' => new PersonalInfo('John Doe', 'john@example.com', '+9779841234567'),
            'membership_number' => new MembershipNumber('UML', '2024', 'F', 1),
            'geography' => SimpleGeography::empty(),
            'status' => MemberStatus::draft(),
        ]);
        
        // Should not throw exception
        $this->assertNull($member->validateForSubmission());
    }
    
    /** @test */
    public function it_requires_personal_info_for_submission(): void
    {
        $member = new Member([
            'personal_info' => null,
            'membership_number' => new MembershipNumber('UML', '2024', 'F', 1),
            'geography' => SimpleGeography::empty(),
            'status' => MemberStatus::draft(),
        ]);
        
        $this->expectException(InvalidMemberException::class);
        $this->expectExceptionMessage('Personal info is required');
        
        $member->validateForSubmission();
    }
    
    /** @test */
    public function it_requires_membership_number_for_submission(): void
    {
        $member = new Member([
            'personal_info' => new PersonalInfo('John Doe', 'john@example.com', '+9779841234567'),
            'membership_number' => null,
            'geography' => SimpleGeography::empty(),
            'status' => MemberStatus::draft(),
        ]);
        
        $this->expectException(InvalidMemberException::class);
        $this->expectExceptionMessage('Membership number is required');
        
        $member->validateForSubmission();
    }
    
    /** @test */
    public function it_requires_draft_status_for_submission(): void
    {
        $member = new Member([
            'personal_info' => new PersonalInfo('John Doe', 'john@example.com', '+9779841234567'),
            'membership_number' => new MembershipNumber('UML', '2024', 'F', 1),
            'geography' => SimpleGeography::empty(),
            'status' => MemberStatus::pending(), // Already submitted
        ]);
        
        $this->expectException(InvalidMemberException::class);
        $this->expectExceptionMessage('Member must be in draft status to submit application');
        
        $member->validateForSubmission();
    }
    
    /** @test */
    public function it_validates_for_approval(): void
    {
        $member = new Member([
            'personal_info' => new PersonalInfo('John Doe', 'john@example.com', '+9779841234567'),
            'membership_number' => new MembershipNumber('UML', '2024', 'F', 1),
            'geography' => SimpleGeography::empty(),
            'status' => MemberStatus::pending(),
        ]);
        
        // Should not throw exception
        $this->assertNull($member->validateForApproval());
    }
    
    /** @test */
    public function it_requires_pending_status_for_approval(): void
    {
        $member = new Member([
            'personal_info' => new PersonalInfo('John Doe', 'john@example.com', '+9779841234567'),
            'membership_number' => new MembershipNumber('UML', '2024', 'F', 1),
            'geography' => SimpleGeography::empty(),
            'status' => MemberStatus::draft(), // Not submitted yet
        ]);
        
        $this->expectException(InvalidMemberException::class);
        $this->expectExceptionMessage('Member must be in pending status to approve');
        
        $member->validateForApproval();
    }
    
    /** @test */
    public function it_validates_for_activation(): void
    {
        $member = new Member([
            'personal_info' => new PersonalInfo('John Doe', 'john@example.com', '+9779841234567'),
            'membership_number' => new MembershipNumber('UML', '2024', 'F', 1),
            'geography' => SimpleGeography::empty(),
            'status' => MemberStatus::approved(),
        ]);
        
        // Should not throw exception
        $this->assertNull($member->validateForActivation());
    }
    
    /** @test */
    public function it_requires_approved_status_for_activation(): void
    {
        $member = new Member([
            'personal_info' => new PersonalInfo('John Doe', 'john@example.com', '+9779841234567'),
            'membership_number' => new MembershipNumber('UML', '2024', 'F', 1),
            'geography' => SimpleGeography::empty(),
            'status' => MemberStatus::pending(), // Not approved yet
        ]);
        
        $this->expectException(InvalidMemberException::class);
        $this->expectExceptionMessage('Member must be in approved status to activate');
        
        $member->validateForActivation();
    }
    
    /** @test */
    public function it_can_check_if_geography_enrichment_possible(): void
    {
        $member = new Member([
            'personal_info' => new PersonalInfo('John Doe', 'john@example.com', '+9779841234567'),
            'membership_number' => new MembershipNumber('UML', '2024', 'F', 1),
            'geography' => SimpleGeography::empty(),
            'status' => MemberStatus::draft(),
        ]);
        
        $this->assertTrue($member->canEnrichGeography());
    }
    
    /** @test */
    public function it_cannot_enrich_geography_when_already_advanced(): void
    {
        $geography = SimpleGeography::empty()
            ->withText('Province 3', 'Kathmandu', 'Ward 5')
            ->withIds(3, 25, 125);
        
        $member = new Member([
            'personal_info' => new PersonalInfo('John Doe', 'john@example.com', '+9779841234567'),
            'membership_number' => new MembershipNumber('UML', '2024', 'F', 1),
            'geography' => $geography,
            'status' => MemberStatus::draft(),
        ]);
        
        $this->assertFalse($member->canEnrichGeography());
    }
    
    /** @test */
    public function it_validates_sponsorship(): void
    {
        $member = new Member([
            'personal_info' => new PersonalInfo('John Doe', 'john@example.com', '+9779841234567'),
            'membership_number' => new MembershipNumber('UML', '2024', 'F', 1),
            'geography' => SimpleGeography::empty(),
            'status' => MemberStatus::draft(),
            'sponsor_id' => 456,
        ]);
        
        $this->assertEquals(456, $member->sponsorId());
        
        // Try to add another sponsor (should not change)
        $member->addSponsorship(789);
        $this->assertEquals(456, $member->sponsorId()); // Should remain first sponsor
    }
    
    /** @test */
    public function it_can_check_if_member_can_be_sponsor(): void
    {
        $member = new Member([
            'personal_info' => new PersonalInfo('John Doe', 'john@example.com', '+9779841234567'),
            'membership_number' => new MembershipNumber('UML', '2024', 'F', 1),
            'geography' => SimpleGeography::empty(),
            'status' => MemberStatus::draft(),
        ]);
        
        $this->assertFalse($member->canSponsorOthers()); // Draft cannot sponsor
        
        $member->submitApplication();
        $member->approve(123);
        $member->activate('pay_12345');
        
        $this->assertTrue($member->canSponsorOthers()); // Active can sponsor
    }
    
    /** @test */
    public function it_provides_member_summary(): void
    {
        $personalInfo = new PersonalInfo('John Doe', 'john@example.com', '+9779841234567');
        $membershipNumber = new MembershipNumber('UML', '2024', 'F', 1);
        $geography = SimpleGeography::empty()
            ->withText('Province 3', 'Kathmandu', 'Ward 5');
        
        $member = Member::create(
            personalInfo: $personalInfo,
            membershipNumber: $membershipNumber,
            geography: $geography
        );
        
        $summary = $member->summary();
        
        $this->assertEquals('John Doe', $summary['full_name']);
        $this->assertEquals('UML-2024-F-000001', $summary['membership_number']);
        $this->assertEquals('Province 3 ‚Üí Kathmandu ‚Üí Ward 5', $summary['geography_display']);
        $this->assertEquals('Draft', $summary['status_display']);
    }
}
```

**Run test (should fail):**
```bash
php artisan test tests/Unit/Contexts/Membership/Domain/Models/MemberValidationTest.php
```

---

## **4Ô∏è‚É£ DOMAIN EVENTS TESTS**

### **Step 1: Create Domain Event Interfaces/Classes**

First, let's create the base Domain Event:

```php
<?php

// app/Contexts/Membership/Domain/Events/DomainEvent.php

namespace App\Contexts\Membership\Domain\Events;

use Illuminate\Foundation\Events\Dispatchable;
use Illuminate\Queue\SerializesModels;
use DateTimeImmutable;

abstract class DomainEvent
{
    use Dispatchable, SerializesModels;
    
    protected DateTimeImmutable $occurredAt;
    
    public function __construct()
    {
        $this->occurredAt = new DateTimeImmutable();
    }
    
    public function occurredAt(): DateTimeImmutable
    {
        return $this->occurredAt;
    }
    
    abstract public function toArray(): array;
}
```

### **Step 2: Create Member Events**

```bash
# Create event files
touch app/Contexts/Membership/Domain/Events/MemberCreated.php
touch app/Contexts/Membership/Domain/Events/MemberApplicationSubmitted.php
touch app/Contexts/Membership/Domain/Events/MemberApproved.php
touch app/Contexts/Membership/Domain/Events/MemberActivated.php
touch app/Contexts/Membership/Domain/Events/MemberSuspended.php
touch app/Contexts/Membership/Domain/Events/MemberGeographyEnriched.php
```

### **Test File: Domain Events Structure**

```php
<?php

// tests/Unit/Contexts/Membership/Domain/Events/MemberEventsTest.php

namespace Tests\Unit\Contexts\Membership\Domain\Events;

use Tests\TestCase;
use App\Contexts\Membership\Domain\Events\MemberCreated;
use App\Contexts\Membership\Domain\Events\MemberApplicationSubmitted;
use App\Contexts\Membership\Domain\Events\MemberApproved;
use App\Contexts\Membership\Domain\Events\MemberActivated;
use App\Contexts\Membership\Domain\Events\MemberSuspended;
use App\Contexts\Membership\Domain\Events\MemberGeographyEnriched;

class MemberEventsTest extends TestCase
{
    /** @test */
    public function member_created_event_has_correct_structure(): void
    {
        $event = new MemberCreated(
            memberId: 'member-123',
            membershipNumber: 'UML-2024-F-000001',
            fullName: 'John Doe',
            geographyTier: 'none'
        );
        
        $this->assertEquals('member-123', $event->memberId);
        $this->assertEquals('UML-2024-F-000001', $event->membershipNumber);
        $this->assertEquals('John Doe', $event->fullName);
        $this->assertEquals('none', $event->geographyTier);
        $this->assertInstanceOf(\DateTimeImmutable::class, $event->occurredAt());
        
        $array = $event->toArray();
        $this->assertEquals('member-123', $array['member_id']);
        $this->assertEquals('MemberCreated', $array['event_type']);
    }
    
    /** @test */
    public function member_application_submitted_event(): void
    {
        $event = new MemberApplicationSubmitted(
            memberId: 'member-123',
            geographyTier: 'basic'
        );
        
        $this->assertEquals('member-123', $event->memberId);
        $this->assertEquals('basic', $event->geographyTier);
    }
    
    /** @test */
    public function member_approved_event(): void
    {
        $event = new MemberApproved(
            memberId: 'member-123',
            committeeMemberId: 456,
            geographyTier: 'basic'
        );
        
        $this->assertEquals('member-123', $event->memberId);
        $this->assertEquals(456, $event->committeeMemberId);
        $this->assertEquals('basic', $event->geographyTier);
    }
    
    /** @test */
    public function member_activated_event(): void
    {
        $event = new MemberActivated(
            memberId: 'member-123',
            paymentId: 'pay_12345',
            geographyTier: 'advanced'
        );
        
        $this->assertEquals('member-123', $event->memberId);
        $this->assertEquals('pay_12345', $event->paymentId);
        $this->assertEquals('advanced', $event->geographyTier);
    }
    
    /** @test */
    public function member_suspended_event(): void
    {
        $event = new MemberSuspended(
            memberId: 'member-123',
            reason: 'Non-payment of dues',
            geographyTier: 'advanced'
        );
        
        $this->assertEquals('member-123', $event->memberId);
        $this->assertEquals('Non-payment of dues', $event->reason);
        $this->assertEquals('advanced', $event->geographyTier);
    }
    
    /** @test */
    public function member_geography_enriched_event(): void
    {
        $event = new MemberGeographyEnriched(
            memberId: 'member-123',
            fromTier: 'basic',
            toTier: 'advanced'
        );
        
        $this->assertEquals('member-123', $event->memberId);
        $this->assertEquals('basic', $event->fromTier);
        $this->assertEquals('advanced', $event->toTier);
    }
    
    /** @test */
    public function all_events_extend_domain_event(): void
    {
        $events = [
            new MemberCreated('1', 'NUM', 'Name', 'none'),
            new MemberApplicationSubmitted('1', 'none'),
            new MemberApproved('1', 1, 'none'),
            new MemberActivated('1', 'pay', 'none'),
            new MemberSuspended('1', 'reason', 'none'),
            new MemberGeographyEnriched('1', 'none', 'basic'),
        ];
        
        foreach ($events as $event) {
            $this->assertInstanceOf(
                \App\Contexts\Membership\Domain\Events\DomainEvent::class,
                $event
            );
            $this->assertInstanceOf(\DateTimeImmutable::class, $event->occurredAt());
            $this->assertIsArray($event->toArray());
        }
    }
}
```

**Run test (should fail - events don't exist yet):**
```bash
php artisan test tests/Unit/Contexts/Membership/Domain/Events/MemberEventsTest.php
```

---

## **5Ô∏è‚É£ CREATE EXCEPTIONS**

### **Step: Create Member Exceptions**

```php
<?php

// app/Contexts/Membership/Domain/Exceptions/InvalidMemberException.php

namespace App\Contexts\Membership\Domain\Exceptions;

use Exception;

class InvalidMemberException extends Exception
{
    public static function missingPersonalInfo(): self
    {
        return new self('Personal info is required');
    }
    
    public static function missingMembershipNumber(): self
    {
        return new self('Membership number is required');
    }
    
    public static function missingGeography(): self
    {
        return new self('Geography is required');
    }
    
    public static function invalidStatusForSubmission(string $currentStatus): self
    {
        return new self("Member must be in draft status to submit application, currently: {$currentStatus}");
    }
    
    public static function invalidStatusForApproval(string $currentStatus): self
    {
        return new self("Member must be in pending status to approve, currently: {$currentStatus}");
    }
    
    public static function invalidStatusForActivation(string $currentStatus): self
    {
        return new self("Member must be in approved status to activate, currently: {$currentStatus}");
    }
    
    public static function geographyAlreadyAdvanced(): self
    {
        return new self('Geography is already at advanced tier');
    }
}
```

---

## **‚úÖ RUN ALL MEMBER TESTS (SHOULD ALL FAIL - RED PHASE)**

```bash
php artisan test tests/Unit/Contexts/Membership/Domain/Models/
php artisan test tests/Unit/Contexts/Membership/Domain/Events/

# Expected: All tests fail because:
# 1. Member model doesn't exist
# 2. Events don't exist
# 3. Methods not implemented
```

---

## **üìù COMMIT RED PHASE**

```bash
git add .
git commit -m "RED: Member Aggregate Root tests (TDD First)

- MemberCreationTest: Basic creation with/without geography
- MemberLifecycleTest: Status transitions and business workflows
- MemberValidationTest: Business rule validations
- MemberEventsTest: Domain event structure tests
- All tests written before implementation (TDD approach)

Next: Implement Member aggregate to make tests pass"
```

---

## **üéØ NEXT: GREEN PHASE IMPLEMENTATION**

Now we have **comprehensive failing tests**. Next step is to implement:

1. **Domain Events** (MemberCreated, MemberApproved, etc.)
2. **Member Aggregate Root** with all business logic
3. **Make all tests pass**

**Should I proceed with implementing the Domain Events first, then the Member aggregate?**