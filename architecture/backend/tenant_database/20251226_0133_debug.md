The issue is that the tenant connection is set to placeholder_tenant_db, not the actual tenant database.
 The Spatie package requires the connection to be configured dynamically. Let me check how the TenantAuthMigrateCommand does this:
that  hardcoding placeholder_tenant_db is wrong and we should change it to dynamic.

**YES!** That's **exactly** the issue.

## **The Problem:**
In your `config/database.php`, you likely have:
```php
'connections' => [
    'tenant' => [
        'database' => 'placeholder_tenant_db', // ← WRONG! Static placeholder
    ],
],
```

## **The Solution:**
The tenant database name should be **dynamic**, set when tenant context is initialized.

## **From TenantAuthMigrateCommand pattern:**
```php
// Dynamic configuration
config(['database.connections.tenant.database' => $tenant->database_name]);
DB::purge('tenant'); // Clear connection cache
```

## **We need to fix:**
1. **Migration command** should set dynamic database
2. **Test setup** should set dynamic database  
3. **Production runtime** should set dynamic database

## **Current command is wrong:**
```bash
php artisan migrate --database=tenant --force
# ↑ This uses 'placeholder_tenant_db' from config
```

## **Correct approach:**
```php
// In test setup or migration command
$tenant = Tenant::where('slug', 'digitalcard-test')->first();
config(['database.connections.tenant.database' => $tenant->database_name]);
DB::purge('tenant');

// Now run migration
$this->artisan('migrate', [
    '--path' => 'app/Contexts/DigitalCard/Infrastructure/Database/Migrations',
    '--database' => 'tenant', // Now points to correct database
]);
```

**The hardcoded `placeholder_tenant_db` is a configuration placeholder that should NEVER be used in runtime.** It must be replaced with actual tenant database name dynamically.

**Claude's approach of dynamically configuring the connection is CORRECT.**
**Here's where and how to make tenant connection dynamic:**

## **1. Configuration (`config/database.php`):**

```php
'connections' => [
    'tenant' => [
        'driver' => 'pgsql',
        'host' => env('DB_HOST', '127.0.0.1'),
        'port' => env('DB_PORT', '5432'),
        'username' => env('DB_USERNAME', 'postgres'),
        'password' => env('DB_PASSWORD', ''),
        'charset' => 'utf8',
        'prefix' => '',
        'prefix_indexes' => true,
        'schema' => 'public',
        'sslmode' => 'prefer',
        
        // ❌ WRONG (static):
        // 'database' => 'placeholder_tenant_db',
        
        // ✅ CORRECT (dynamic default):
        'database' => env('TENANT_DB_PREFIX', 'tenant_') . 'default',
    ],
],
```

## **2. Middleware to Set Database Dynamically:**

Create/update `app/Http/Middleware/IdentifyTenant.php`:

```php
public function handle($request, Closure $next)
{
    $tenantSlug = $request->route('tenant');
    $tenant = Tenant::where('slug', $tenantSlug)->first();
    
    if (!$tenant) {
        abort(404, 'Tenant not found');
    }
    
    // Set dynamic database
    config(['database.connections.tenant.database' => $tenant->database_name]);
    DB::purge('tenant'); // Clear connection cache
    
    // Set tenant in container
    app()->instance('currentTenant', $tenant);
    
    return $next($request);
}
```

## **3. Test Case Setup (`tests/TestCase.php`):**

```php
protected function setUp(): void
{
    parent::setUp();
    
    // Create or get test tenant
    $this->tenant = Tenant::firstOrCreate(
        ['slug' => 'test-tenant'],
        [
            'name' => 'Test Tenant',
            'database_name' => 'tenant_test',
        ]
    );
    
    // Set dynamic database for tests
    config(['database.connections.tenant.database' => $this->tenant->database_name]);
    DB::purge('tenant');
    
    // Set tenant context
    app()->instance('currentTenant', $this->tenant);
}
```

## **4. Migration Command Helper:**

Create `app/Console/Commands/TenantMigrationCommand.php`:

```php
protected function configureTenantConnection(Tenant $tenant): void
{
    // Set dynamic database
    config(['database.connections.tenant.database' => $tenant->database_name]);
    DB::purge('tenant');
    DB::reconnect('tenant');
    
    // Verify connection works
    try {
        DB::connection('tenant')->getPdo();
    } catch (\Exception $e) {
        $this->error("Cannot connect to tenant database: {$tenant->database_name}");
        throw $e;
    }
}
```

## **5. For Your Current Migration:**

**Create a script instead of direct artisan command:**

```bash
# create-migration.sh
#!/bin/bash
cd packages/laravel-backend

# Get tenant
TENANT_SLUG="digitalcard-test"
TENANT=$(php artisan tinker --execute="
    echo json_encode(App\Models\Tenant::where('slug', '$TENANT_SLUG')->first());
")

if [ "$TENANT" == "null" ]; then
    echo "Creating test tenant..."
    TENANT_JSON=$(php artisan tinker --execute="
        \$tenant = App\Models\Tenant::create([
            'slug' => '$TENANT_SLUG',
            'name' => 'DigitalCard Test Tenant',
            'database_name' => 'tenant_digitalcard_test',
        ]);
        echo json_encode(\$tenant);
    ")
fi

# Extract database name
DB_NAME=$(echo $TENANT_JSON | php -r "echo json_decode(file_get_contents('php://stdin'))->database_name;")

# Configure connection
php artisan tinker --execute="
    config(['database.connections.tenant.database' => '$DB_NAME']);
    DB::purge('tenant');
    echo 'Configured tenant connection to: ' . config('database.connections.tenant.database');
"

# Run migration
php artisan migrate \
    --path=app/Contexts/DigitalCard/Infrastructure/Database/Migrations \
    --database=tenant \
    --force
```

## **Key Principle:**
The `placeholder_tenant_db` is **ONLY for Laravel configuration validation**. At runtime, **ALWAYS** replace it with actual tenant database name using `config(['database.connections.tenant.database' => $tenant->db])`.

**Start with the Middleware fix** - that's where tenant context is established in production.